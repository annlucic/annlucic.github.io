## Автоматизация в Яндекс.Дзене

**Описание проекта:** В проекте моделируется ситуация, когда необходимо автоматизировать процесс и сделать дашборд. Дашборд позволит автоматизировать регулярную задачу и упростить менеджерам процесс получения данных по взаимодействию пользователей с карточками статей.

**Данные:** бэкап-файл с базы данных PostgreSQL (на период проектирования и тестирования, администраторы БД выделили тестовую базу zen, создали там таблицу log_raw и выгрузили в неё 322 391 записей из основной таблицы логов)

Каждую карточку определяют её тема и источник. Пользователей системы характеризует возрастная категория. Есть три способа взаимодействия пользователей с системой: отображение карточки (show), клик (click), просмотр (view). 

В таблице log_raw: 
- сохранены события за 60 минут;
- всего 6 возрастных групп;
- встречаются события 3 типов;
- есть 25 тем карточек и 26 тем источников.

Проект Яндекс.Практикума

**Задача:** Сделать дашборд, позволяющий ответить на вопросы:

- Сколько взаимодействий пользователей с карточками происходит в системе с разбивкой по темам карточек?
- Как много карточек генерируют источники с разными темами?
- Насколько хорошо пользователи конвертируются из показов карточек в просмотры статей?

Совместно с менеджерами и администраторами баз данных, составлено краткое ТЗ.

На основании ТЗ дашборде нужно отобразить:
- Историю событий по минутам с разбивкой по темам карточек;
- Разбивку всех событий по темам источников;
- Усреднённую воронку: уникальные показы -> уникальные клики -> уникальные просмотры.

Кроме того, понадобится обеспечить фильтрацию по времени, темам карточек и возрастным группам.

### 1. Подготовка данных

- Создана виртуальная машина в Яндекс.Облаке 
- Установлена PostgreSQL 
- Развернута база данных из dump-файла
- Установлен пакетный менеджер и библиотеки

```bash
sudo apt install python3-pip
sudo pip3 install dash==1.6.1
sudo pip3 install sqlalchemy
sudo apt-get install python3-psycopg2
sudo pip3 install pandas
```

### 3. Создание аггрегирующих таблиц

В базе данных создано две аггрегирующие таблицы.
1. Таблица воронки просмотров 
```SQL
CREATE TABLE dash_engagement(record_id serial PRIMARY KEY, 
                             dt TIMESTAMP,        
                             item_topic VARCHAR(128),     
                             event VARCHAR(128),    
                             age_segment VARCHAR(128),
                             unique_users BIGINT);
```                     
2. Таблица истории событий

```SQL
CREATE TABLE dash_visits(record_id serial PRIMARY KEY,       
                         item_topic VARCHAR(128),
                         source_topic VARCHAR(128),
                         age_segment VARCHAR(128),
                         dt TIMESTAMP,
                         visits INT);
```  
### 4. Пайплайн

1. Заданы входные параметры пайплайна: `start_dt` и `end_dt`
2. Задано подключение к БД 
3. Задана группировка для датафреймов событий и воронок в соответствии с определениями их таблиц.
4. Добавлено удаление ранее записанных данных и запись новых данных.
5. Вызван скрипт пайплайна для всего диапазона тестовых данных

### 5. Дашборд
Порядок элементов управления:

1. График событий во времени

<img src="images/dash_plot1.png?raw=true"/>

2. Круговая диаграмма событий

<img src="images/dash_plot2.png?raw=true"/>

3. Столбчатая диаграмма глубины взаимодействия

<img src="images/dash_plot3.png?raw=true"/>

### 6. Используемые инструменты

Библиотеки python - dash, pandas, sqlalchemy, psycopg2

Виртуальная машина в Яндекс.Облаке(ubuntu)

PostgreSQL 

Правилами Яндекс.Практикума запрещено выкладывать проекты в открытый доступ, поэтому [Полная версия проекта на github](https://github.com/annlucic/yandex_praktikum/blob/master/ab_testing.ipynb), содержащая скрипты пайплайна и дашборда доступна по запросу.


